#include <stdio.h>
#include <string.h>

struct index_t {
  unsigned char state[5];
  int index;
};

struct ddd_t {
  unsigned char city[7];
  unsigned char ddd[5];
};

struct index_t index[15] = {
  { "경기",   0 }, { "강원",  46 }, { "충북",  76 }, { "충남",  91 },
  { "경북", 123 }, { "경남", 166 }, { "전북", 201 }, { "전남", 219 },
  { "", 246 }
};

struct ddd_t metro[8] = {
  { "서울", "02" }, { "부산", "051" }, { "대구", "053" },
  { "인천", "032" }, { "광주", "062" }, { "대전", "042" },
  { "제주", "064" }, { "", "" }
};

struct ddd_t cityddd[246] = {
  { "가평",   "0356" }, { "강화",   "0349" }, { "고양",   "0344" },
  { "과천",     "02" }, { "광명",     "02" }, { "광주",   "0347" },
  { "구리",   "0346" }, { "군포",   "0343" }, { "김포",   "0341" },
  { "남양",   "0339" }, { "남양주", "0346" }, { "동두천", "0351" },
  { "문산",   "0348" }, { "미금",   "0346" }, { "발안",   "0339" },
  { "부천",    "032" }, { "송탄",   "0333" }, { "수원",   "0331" },
  { "시흥",   "0345" }, { "성남",   "0342" }, { "안산",   "0345" },
  { "안성",   "0334" }, { "안양",   "0343" }, { "안중",   "0333" },
  { "양주",   "0351" }, { "양평",   "0338" }, { "여주",   "0337" },
  { "연천",   "0355" }, { "오산",   "0339" }, { "옹진",    "032" },
  { "용문",   "0338" }, { "용인",   "0335" }, { "원당",   "0344" },
  { "의왕",   "0343" }, { "의정부", "0351" }, { "이천",   "0336" },
  { "일산",   "0344" }, { "장호원", "0336" }, { "전곡",   "0355" },
  { "청평",   "0356" }, { "통진",   "0341" }, { "평택",   "0333" },
  { "파주",   "0348" }, { "포천",   "0357" }, { "하남",   "0347" },
  { "하성",   "0339" }, { "강릉",   "0391" }, { "고성",   "0392" },
  { "근덕",   "0397" }, { "대화",   "0374" }, { "도계",   "0395" },
  { "동송",   "0353" }, { "동해",   "0394" }, { "명주",   "0391" },
  { "북평",   "0394" }, { "삼척",   "0397" }, { "상동",   "0373" },
  { "설악",   "0392" }, { "속초",   "0392" }, { "양구",   "0364" },
  { "양양",   "0396" }, { "영월",   "0373" }, { "원주",   "0371" },
  { "인제",   "0365" }, { "정선",   "0398" }, { "주문진", "0391" },
  { "철원",   "0353" }, { "춘성",   "0361" }, { "춘천",   "0361" },
  { "태백",   "0395" }, { "평창",   "0374" }, { "홍천",   "0366" },
  { "화광",   "0395" }, { "화천",   "0363" }, { "횡계",   "0374" },
  { "횡성",   "0372" }, { "괴산",   "0445" }, { "단양",   "0444" },
  { "무극",   "0446" }, { "보은",   "0433" }, { "영동",   "0414" },
  { "옥천",   "0475" }, { "음성",   "0446" }, { "제원",   "0443" },
  { "제천",   "0443" }, { "증평",   "0445" }, { "중원",   "0441" },
  { "진천",   "0434" }, { "창원",   "0431" }, { "청주",   "0431" },
  { "충주",   "0441" }, { "강경",   "0461" }, { "공주",   "0416" },
  { "광천",   "0451" }, { "금산",   "0412" }, { "논산",   "0461" },
  { "당진",   "0457" }, { "대천",   "0452" }, { "둔포",   "0418" },
  { "보령",   "0452" }, { "부여",   "0463" }, { "삽교",   "0458" },
  { "서산",   "0455" }, { "서천",   "0459" }, { "성환",   "0417" },
  { "신탄진",  "042" }, { "아산",   "0418" }, { "예산",   "0458" },
  { "연기",   "0415" }, { "연무대", "0461" }, { "온양",   "0418" },
  { "유구",   "0416" }, { "유성",    "042" }, { "장항",   "0459" },
  { "전의",   "0415" }, { "조치원", "0415" }, { "천안",   "0417" },
  { "천원",   "0417" }, { "청양",   "0454" }, { "한산",   "0459" },
  { "합덕",   "0457" }, { "홍성",   "0451" }, { "태안",   "0455" },
  { "가은",   "0581" }, { "건천",   "0561" }, { "경산",    "053" },
  { "경주",   "0561" }, { "고령",   "0543" }, { "구미",   "0546" },
  { "구룡포", "0562" }, { "군위",   "0578" }, { "금릉",   "0547" },
  { "김천",   "0547" }, { "달성",    "053" }, { "동명",   "0545" },
  { "문경",   "0581" }, { "봉화",   "0583" }, { "상주",   "0582" },
  { "선산",   "0546" }, { "성주",   "0544" }, { "안강",   "0561" },
  { "안계",   "0576" }, { "안동",   "0571" }, { "영덕",   "0564" },
  { "영양",   "0574" }, { "영일",   "0562" }, { "영주",   "0572" },
  { "영풍",   "0572" }, { "영천",   "0563" }, { "예천",   "0584" },
  { "의성",   "0576" }, { "왜관",   "0545" }, { "울릉",   "0566" },
  { "울진",   "0565" }, { "점촌",   "0581" }, { "죽변",   "0565" },
  { "진보",   "0575" }, { "청도",   "0542" }, { "청송",   "0575" },
  { "칠곡",   "0545" }, { "탑리",   "0576" }, { "풍기",   "0572" },
  { "포항",   "0562" }, { "하양",   "0541" }, { "현풍",    "053" },
  { "후포",   "0565" }, { "거제",   "0558" }, { "거창",   "0598" },
  { "고성",   "0556" }, { "고현",   "0558" }, { "김해",   "0525" },
  { "남지",   "0559" }, { "남해",   "0594" }, { "마산",   "0551" },
  { "밀양",   "0527" }, { "사천",   "0593" }, { "산청",   "0596" },
  { "삼랑진", "0527" }, { "삼천포", "0593" }, { "수산",   "0527" },
  { "양산",   "0523" }, { "영산",   "0559" }, { "온산",   "0522" },
  { "울산",   "0522" }, { "울주",   "0522" }, { "의령",   "0555" },
  { "의창",   "0551" }, { "장승포", "0558" }, { "지족",   "0594" },
  { "진양",   "0591" }, { "진영",   "0525" }, { "진주",   "0591" },
  { "진해",   "0553" }, { "창녕",   "0559" }, { "창원",   "0551" },
  { "충무",   "0557" }, { "통영",   "0557" }, { "하동",   "0595" },
  { "함안",   "0552" }, { "함양",   "0597" }, { "합천",   "0599" },
  { "고창",   "0677" }, { "군산",   "0654" }, { "김제",   "0658" },
  { "남원",   "0671" }, { "무주",   "0657" }, { "부안",   "0683" },
  { "순창",   "0674" }, { "완주",   "0652" }, { "옥구",   "0654" },
  { "이리",   "0653" }, { "익산",   "0653" }, { "임실",   "0673" },
  { "장계",   "0656" }, { "장수",   "0656" }, { "전주",   "0652" },
  { "정읍",   "0681" }, { "정주",   "0681" }, { "진안",   "0655" },
  { "강진",   "0638" }, { "고흥",   "0666" }, { "곡성",   "0688" },
  { "광양",   "0667" }, { "구례",   "0664" }, { "나주",   "0613" },
  { "담양",   "0684" }, { "동광양", "0667" }, { "목포",   "0631" },
  { "무안",   "0636" }, { "벌교",   "0694" }, { "보성",   "0694" },
  { "순천",   "0661" }, { "승주",   "0661" }, { "신안",   "0631" },
  { "여수",   "0662" }, { "여천",   "0662" }, { "영광",   "0686" },
  { "영암",   "0693" }, { "옥곡",   "0667" }, { "완도",   "0633" },
  { "장성",   "0685" }, { "장흥",   "0665" }, { "진도",   "0632" },
  { "함평",   "0615" }, { "해남",   "0634" }, { "화순",   "0612" }
};

/*
 * 주소에서 지역번호 찾기
 */
unsigned char *addr2ddd( unsigned char *addr, unsigned char *result)
{
  unsigned char city[80], state[80], *cityp, *statep;
  int i, j, cmp;

  cityp = city, statep = state;
  /* 앞부분의 공백을 지나서 */
  while(*addr == ' ')
    addr++;
  while(*addr && *addr != ' ')
    *cityp++ = *addr++;
  *cityp = NULL, addr++;
  while(*addr && *addr != ' ')
    *statep++ = *addr++;
  *statep = NULL;
  /* 특별시/직할시 또는 제주도 냐 ? */
  for(i = 0; metro[i].city[0]; i++) {
    cmp = strncmp(metro[i].city, city, strlen(metro[i].city));
    if(!cmp) {
      strcpy(result, metro[i].ddd);
      return metro[i].ddd;
    }
  }
  /* 그러면 무슨도냐 ? */
  for(i = 0; index[i].state[0]; i++) {
    if(!strncmp(index[i].state, city, strlen(index[i].state))) {
      for(j = index[i].index; j < index[i+1].index; j++) {
        cmp = strncmp(cityddd[j].city, state, strlen(cityddd[j].city));
        if(!cmp) {
          strcpy(result, cityddd[j].ddd);
          return cityddd[j].ddd;
        }
      }
    }
  }
  return NULL;
}
